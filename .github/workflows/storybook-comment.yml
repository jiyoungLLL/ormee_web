name: Comment Storybook Preview on PR

on:
  repository_dispatch:
    types: [storybook_deploy_detected]

jobs:
  comment:
    runs-on: ubuntu-latest

    steps:
      - name: Extract dispatch payload
        id: input
        run: |
          echo "branch=${{ github.event.client_payload.branch }}" >> $GITHUB_OUTPUT
          echo "url=${{ github.event.client_payload.url }}" >> $GITHUB_OUTPUT
          echo "state=${{ github.event.client_payload.state }}" >> $GITHUB_OUTPUT

      - name: Debug - Show extracted values
        run: |
          echo "ğŸ” Dispatch values:"
          echo "  Branch = ${{ steps.input.outputs.branch }}"
          echo "  URL    = ${{ steps.input.outputs.url }}"
          echo "  State  = ${{ steps.input.outputs.state }}"

      - name: Comment on PR with preview URL
        uses: marocchino/sticky-pull-request-comment@v2
        with:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          header: storybook-preview
          message: |
            ğŸš€ **Storybook Preview**
            ğŸ”— [ë¯¸ë¦¬ë³´ê¸° ì—´ê¸°](${{ steps.input.outputs.url }})
            ğŸŸ¡ ìƒíƒœ: `${{ steps.input.outputs.state }}`

            _ë¯¸ë¦¬ë³´ê¸° ë§í¬ëŠ” ë¸Œëœì¹˜ê°€ ì—…ë°ì´íŠ¸ë˜ë©´ ìë™ìœ¼ë¡œ ìµœì‹  ìƒíƒœë¡œ êµì²´ë©ë‹ˆë‹¤._
